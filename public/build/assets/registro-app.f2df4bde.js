/* empty css              *//* empty css                   */import{s as h,v as p,m as g}from"./validates.dd8a5988.js";import{m as d}from"./toast.04e64154.js";import{l as v}from"./ods.480fe64b.js";class x{constructor(e,i,a,s,o,n){this.id=e,this.name=i,this.file=a,this.galeria=s,this.icon=o,this.id_archivo=n,this.preview=!1,this.uploaded=!1}}class w{constructor(){this.files=[]}autoincrement(){return this.getLastFile()?this.getLastFile().id+1:0}push(e){this.files.push(e)}getFile(e){return this.files[e]}getLastFile(){return this.files[this.files.length-1]}filesNoPreviewByGaleria(e){return this.files.filter(i=>i.galeria==e&&!i.preview)}getfilesNoUpLoaded(){return this.files.filter(e=>!e.uploaded)}setFilesFromArrayFile(e,i,a=null){e.forEach(s=>{this.push(new x(this.autoincrement(),s.name,s,i,h(s.name),a))})}searchFileById(e){return this.files.find(i=>i.id==e)}removeFileById(e){this.files=this.files.filter(i=>i.id!=e)}}const F=g("2");let r=new w;$("input[type=file]").change(function(t){t.preventDefault(),console.log("antes",r);let e=p(this.files,y(this),F);r.setFilesFromArrayFile(e,this.dataset.gallery,this.dataset.registro),$(this).closest("article.panel-documentos").trigger("generate_files",this.dataset.gallery)});function y(t){return t.getAttribute("accept").split(",").map(e=>e.trim())}$("article.panel-documentos").on("generate_files",function(t,e){e&&D($(this),e)}).on("click",".eliminar",function(t){t.preventDefault();let e=$(this).closest(".dataFile");e.data("idArchivo")?_(e.data("idArchivo"),this):(r.removeFileById(e.data("idFile")),m($(this).closest(".item-file")))});function D(t,e="imagenes"){let i=t.find(".list-files"),a=r.filesNoPreviewByGaleria(e);a.length>0&&t.find(".section-files").removeClass("hidden"),e!="imagenes"?a.forEach(s=>{let o=`<i class="${s.icon} info_color text-[30px]"></i>`;f(i,s,o)}):a.forEach(s=>{b(s,i)}),console.log(r.files)}function b(t,e){let i=new FileReader;i.onload=a=>{let s=`
        <img class="object-cover h-full" src="${a.target.result}" alt="">
        `;f(e,t,s)},i.readAsDataURL(t.file)}function f(t,e,i){t.prepend(L(e,i)),e.preview=!0,e.id_archivo?(t.find(".subirFile").trigger("submit",e.id_archivo),e.uploaded=!0):r.files.length>0&&r.filesNoPreviewByGaleria(e.galeria).length==0&&$("form#registro").trigger("submit","files")}function L(t,e){return`
    <div class="item-file to_animate animated slideDown" data-animation="slideDown" data-delay="500">
        <span class="w-[30px] h-[30px] preview">
            ${e}
        </span>
        <span class="grow overflow-hidden">
            <div class="flex justify-stretch">
                <div class="file-name grow overflow-hidden whitespace-nowrap text-ellipsis">${t.name}</div>
                <span class="inline-block w-[30px] text-right progress-text">0%</span>
            </div>
            <div class="progress my-1">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: 0%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </span>
        <span class="w-[30px] text-right dataFile" data-id-file="${t.id} ">
            <i class="eliminar rt-icon2-trashcan text-red-600 text-xl hover:text-red-900 cursor-pointer" title="Eliminar"></i>
            <i class="hidden text-xl text-green-500 rt-icon2-checkmark2"></i>
            <i class="hidden text-3xl danger_color rt-icon2-refresh"></i>
            <button class="hidden subirFile" >Cargar</button>
        </span>
    </div>
    `}function _(t,e){axios.post(`/documento/${t}/delete`).then(i=>{i.status==200?m($(e).closest(".item-file")):console.log(i)}).catch(i=>{console.error(i)})}function m(t){t.addClass("slideOutUp").hide(500,function(){t.remove()})}$("article.panel-documentos").on("submit",".subirFile",function(t,e,i=null,a=null){t.preventDefault();let s=$(this).closest(".item-file"),o=r.searchFileById(s.find(".dataFile").data("idFile"));o.uploaded||A({itemDom:s,url:`/documento/${e}/registro`,archivo:o,tipo:i,redirect:a})});async function A(t){var n;let e=t.archivo,i=t.itemDom.find(".progress-bar"),a=t.itemDom.find(".progress-text"),s=new FormData;s.append("file",e.file),s.append("folder",e.galeria),s.append("tipo",e.galeria);const o=await axios.post(t.url,s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress(l){let c=Math.round(l.loaded*100/l.total);i.css("width",c+"%"),a.html(c+"%")}});if(o.status==200){e.uploaded=!0;let l=t.itemDom.find(".preview").html();r.removeFileById(e.id),t.itemDom.find(".preview").html(u("/documento/"+o.data.id,l)),t.itemDom.find("button.subirFile").remove(),t.itemDom.find(".file-name").html(u("/documento/"+o.data.id,(n=o.data.name_original)!=null?n:$res.data.name)),t.itemDom.find(".dataFile")[0].dataset.idArchivo=o.data.id,r.getfilesNoUpLoaded().length==0&&(tipo==null?Swal.fire({title:"Su registro est\xE1 siendo procesado!",html:`
                    <div class="">(Esto normalmente tarda un d\xEDa)</div>
                    <p class="text-xs text-red-600 mt-4">Cada uno de los registros pasa por un proceso de revisi\xF3n r\xE1pido, antes de aparecer en el mapa.</p>
                    <p class="text-xs text-red-600 mt-4">Le enviaremos un email cuando haya sido aprobado.</p>
                    `,confirmButtonText:"Ok"}).then(c=>{c.isConfirmed&&setTimeout(function(){window.location.href=t.redirect},500)}):tipo=="files"&&d({clase:"success",mensaje:"Los Documentos han sido Guardados"}))}}function u(t,e){return`<a href="${t}" target="_blank">${e}</a>`}$(window).on("load",()=>{$("#ciudad").data("id")?$("#pais").trigger("change",[$("#ciudad").data("id")]):$("#pais").trigger("change")});$("input#estado").on("change",function(t){let e=$(this).is(":checked")?"Aprobado ":"En Revisi\xF3n";$(this).next("span").text(e)});$("#pais").on("change",function(t,e){if($("#pais option:selected").val()){let i=$("#pais option:selected").val();$("#ciudad").empty(),axios.get(`/pais/${i}/ciudades/`).then(a=>{if(a.status===200&&a.data.length>0){let s=a.data;for(const o of s)$("#ciudad").append(`
                        <option value="${o.id}">${o.name}</option>
                    `);e&&$("#ciudad").val(e)}else $("#ciudad").append(`
                <option value="" selected disabled>No se encontro ciudades relacionados</option>
            `)}).catch(a=>{console.log(a),$("#ciudad").append(`
                <option value="" selected disabled>No se encontro ciudades relacionados</option>
            `)})}});$("form#registro").on("submit",function(t,e=null){t.preventDefault(),this.action.includes("crear")&&d({clase:"info",mensaje:"Se est\xE1 Creando un nuevo registro para guardar los Documentos"}),C(this).then(i=>{var a;if(i.status==200){let s=$("article.panel-documentos .subirFile"),o=(a=i.data.registro)!=null?a:i.data;i.data.mensaje&&d({clase:"success",mensaje:i.data.mensaje}),s.length>0?(this.action=this.action.replace("crear",`${o.id}/update`),$("input[type=file]").each(function(n){this.dataset.registro=o.id}),s.trigger("submit",[o.id,e,i.data.redirect])):Swal.fire({title:"Su registro est\xE1 siendo procesado!",html:`
                    <div class="">(Esto normalmente tarda un d\xEDa)</div>
                    <p class="text-xs text-red-600 mt-4">Cada uno de los registros pasa por un proceso de revisi\xF3n r\xE1pido, antes de aparecer en el mapa.</p>
                    <p class="text-xs text-red-600 mt-4">Le enviaremos un email cuando haya sido aprobado.</p>
                    `,confirmButtonText:"Ok"}).then(n=>{n.isConfirmed&&setTimeout(function(){var l;window.location.href=(l=i.data.redirect)!=null?l:"/profile"},500)})}}).catch(i=>E(i.response))});async function C(t){let e=$(t).serializeArray().reduce(function(i,a){return i[a.name]=a.value,i},{});return e.ods=JSON.stringify(v($(".ods .marco.active"))),$("input#estado").length==1&&(e.estado=$("input#estado").is(":checked")),await axios.post(t.action,e)}function E(t){if(console.log(t),d({clase:"warning",mensaje:"No se ha Creado un Registro y no se Guard\xF3 los Archivos"}),t.status==422){let e=t.data.errors;for(const i in e)e[i].forEach(a=>{d({clase:"danger",mensaje:a})});d({clase:"error",timer:9e3,mensaje:"Por favor, llene los Campos necesarios para Crear un nuevo registro"})}}
